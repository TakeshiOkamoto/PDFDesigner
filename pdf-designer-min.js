/**************************************************/
/*                                                */
/*     PDFDesigner                                */
/*                         JavaScript version     */
/*                                      v1.00     */
/*     http://www.petitmonte.com/pdfdesigner/     */
/*                                                */
/*     Copyright 2015 Takeshi Okamoto (Japan)     */
/*     Released under the MIT license             */
/*                                                */
/*                            Date: 2015-12-24    */
/**************************************************/
function PDF_SeekPos(e){for(var t;;)if("\n"!=(t=e.ReadString(1))&&"\r"!=t&&" "!=t){e.Pos=e.Pos-1;break}}function PDF_CommnetSkip(e){for(var t;"\n"!=(t=e.ReadString(1))&&"\r"!=t;);}function PDF_GetString(e){var t,r="";for(PDF_SeekPos(e);;){if("\n"==(t=e.ReadString(1))||"\r"==t||" "==t||"/"==t||"["==t||"]"==t||"("==t||")"==t||"<"==t||">"==t||"%"==t){if("\n"==t||"\r"==t||" "==t){e.Pos=e.Pos-1;break}if(""!=r){e.Pos=e.Pos-1;break}if("/"!=t){r=t;break}}r+=t}return r}function PDF_TextSkip(e){for(var t;t=e.ReadString(1),!(e.Pos>e.FileSize);)if("\\"==t){if(t=e.ReadString(1),e.Pos>e.FileSize)break;if("\n"==t||"\r"==t)"\r"==t&&"\n"!=(t=e.ReadString(1))&&(e.Pos=e.Pos-1);else if(t.match(/[0-9]+/)){if(t=e.ReadString(1),e.Pos>e.FileSize||")"==t)break;if(t.match(/[^0-9]+/))continue;if(t=e.ReadString(1),e.Pos>e.FileSize||")"==t)break;if(t.match(/[^0-9]+/))continue}}else if(")"==t)break}function PDF_TopLineSkip(e){var t;PDF_GetString(e),PDF_GetString(e),PDF_GetString(e),"%"==(t=PDF_GetString(e))?PDF_CommnetSkip(e):e.Pos=e.Pos-t.length}function PDF_DictionarySkip(e){for(var t,r=0,i=!1;;)if("<"==(t=PDF_GetString(e)))r++;else if(">"==t){if(0==--r){i=!0;break}}else if("%"==t)PDF_CommnetSkip(e);else if("("==t)PDF_TextSkip(e);else if("endobj"==t){i=!1;break}return i}function PDF_ArraySkip(e){for(var t,r=!1;;){if("]"==(t=PDF_GetString(e))){r=!0;break}if("<"==t){if(e.Pos=e.Pos-1,!PDF_DictionarySkip(e)){r=!1;break}}else if("%"==t)PDF_CommnetSkip(e);else if("("==t)PDF_TextSkip(e);else if("endobj"==t){r=!1;break}}return r}function PDF_NameSkip(e){for(var t,r=!1;;){if(""==(t=PDF_GetString(e))&&Continue,"/"==t[0]){r=!0;break}if("%"==t)PDF_CommnetSkip(e);else if("endobj"==t){r=!1;break}}return r}function PDF_GetMediaBoxRect(e){var t=e,r=0;function i(){for(var e="";!(r>=t.length-1||"+"==t[r]||"-"==t[r]||t[r].match(/[0-9]+/));)r++;for(;!(r>=t.length-1)&&"\n"!=t[r]&&"\r"!=t[r]&&" "!=t[r]&&"]"!=t[r];)e+=t[r],r++;return""==e&&(e="0"),e}var n=new TRect;try{n.Left=Math.round(parseFloat(i())),n.Top=Math.round(parseFloat(i())),n.Right=Math.round(parseFloat(i())),n.Bottom=Math.round(parseFloat(i()))}catch(e){n.Left=0,n.Top=0,n.Right=0,n.Bottom=0}return n}function PDF_RectToWidth(e){return e.Left<=e.Right?e.Right-e.Left:e.Left-e.Right}function PDF_RectToHeight(e){return e.Top<=e.Bottom?e.Bottom-e.Top:e.Top-e.Bottom}function PDF_mmToPts(e){return Math.round(72/25.4*e)}function PDF_PtsTomm(e){return Math.round(25.4*e/72)}function PDF_GetDateTime_Now(){function e(e){var t=e+"";return 1==t.length?"0"+t:t}var t=new Date;return t.getFullYear()+e(t.getMonth()+1)+e(t.getDate())+e(t.getHours())+e(t.getMinutes())+e(t.getSeconds())}function PDF_OverlappingCut(e){for(var t,r=new Array,i=!1,n=e.length,o=new Array,a=0;a<n;a++)r[r.length]=-1;for(a=0;a<n;a++){i=!1,t=e[a];for(var s=0;s<n;s++)if(t==r[s]){i=!0;break}i||(o[o.length]=e[a],r[a]=t)}return o}function PDF_StrToIntDef(e,t){var r=parseInt(e,10);return isNaN(r)&&(r=t),r}function PDF_StrToFloatDef(e,t){var r=-32768;return"null"!=e&&(r=parseFloat(e)),isNaN(r)&&(r=t),r}function PDF_ConvertObjectPos(e,t){for(var r=e+"",i=r.length,n="",o=0;o<t-i;o++)n+="0";return n+r}function PDF_RGB(e,t,r){var i=new TColor;return i.Red=e,i.Green=t,i.Blue=r,i}function TPDFObjMemManager(){this.ObjectIndex=0,this.ObjectPosArray=new Array}function TReadStream(e){this.Pos=0,this.Stream=e,this.FileSize=e.length}function TMemoryStream(e,t,r){this.Pos=0,e.Stream.subarray?this.Stream=new Uint8Array(e.Stream.subarray(t,r)):this.Stream=new Uint8Array(Stream.subarray(t,r))}function TFileStream(e){this.MemorySize=null==e?3e7:parseInt(e,10),this.Pos=0,this.Size=0,this.Stream=new Uint8Array(this.MemorySize),this.WriteString("%PDF-")}function TColor(){this.Red=0,this.Green=0,this.Blue=0}function TRect(){this.Left=0,this.Top=0,this.Right=0,this.Bottom=0}function TPDFAnalyst(e){this.FileName=e,this.Version="",this.Stream=null,this.ObjectCount=-1,this.ObjectPosArray=new Array,this.DeleteObject=new Array,this.XrefTableList=new Array,this.Encrypt=!1,this.Optimize=!1,this.Tag=!1,this.PageCount=-1,this.PageSize=new TRect,this.RootID=-1,this.InfoID=-1,this.MetadataID=-1,this.FirstPageID=-1,this.FirstPagesID=-1,this.OutlinesID=-1}function TPDFParser(e,t){this._PageList=t,this._ObjectMem=e}function TPDFCode(){}function TPDFDocInfo(){this.Title="",this.Subject="",this.Author="",this.Keywords="",this.Creator="",this.Producer="",this.CreationDate="",this.ModDate="",this.Trapped=!1}TReadStream.prototype={Read:function(e){var t=this.Stream.subarray(this.Pos,this.Pos+e);return this.Pos=this.Pos+e,t},ReadString:function(e){var t=String.fromCharCode.apply(null,this.Stream.subarray(this.Pos,this.Pos+e));return this.Pos=this.Pos+e,t}},TMemoryStream.prototype={_AsciiToUint8Array:function(e){for(var t=e.length,r=new Uint8Array(t),i=0;i<t;i++)r[i]=e[i].charCodeAt(0);return r},_Combine:function(e,t){var r=e.length,i=t.length,n=new Uint8Array(r+i);return n.set(e,0),n.set(t,r),n},Read:function(e){var t=this.Stream.subarray(this.Pos,this.Pos+e);return this.Pos=this.Pos+e,t},ReadString:function(e){var t=String.fromCharCode.apply(null,this.Stream.subarray(this.Pos,this.Pos+e));return this.Pos=this.Pos+e,t},WriteString:function(e){this.Stream=this._Combine(this.Stream,this._AsciiToUint8Array(e))},WriteStream:function(e,t,r){e.Stream.subarray?this.Stream=this._Combine(this.Stream,e.Stream.subarray(t,r)):this.Stream=this._Combine(this.Stream,e.subarray(t,r))},getFileSize:function(){return this.Stream.length}},TFileStream.prototype={_AsciiToUint8Array:function(e){for(var t=e.length,r=new Uint8Array(t),i=0;i<t;i++)r[i]=e[i].charCodeAt(0);return r},WriteString:function(e){var t=this._AsciiToUint8Array(e);if(this.Stream.length<=this.Size+t.length){var r=new Uint8Array(this.Stream);this.Stream=new Uint8Array(this.Size+t.length+this.MemorySize),this.Stream.set(r.subarray(0,r.length))}this.Stream.set(t,this.Size),this.Size=this.Size+t.length},WriteStream:function(e,t,r){var i=e.Stream.subarray(t,r);if(this.Stream.length<=this.Size+i.length){var n=new Uint8Array(this.Stream);this.Stream=new Uint8Array(this.Size+i.length+this.MemorySize),this.Stream.set(n.subarray(0,n.length))}this.Stream.set(i,this.Size),this.Size=this.Size+i.length},Rewrite:function(e){this.Stream.length<=e.getFileSize()&&(this.Stream=new Uint8Array(e.getFileSize()+this.MemorySize)),this.Stream.set(e.Stream,0),this.Size=e.getFileSize()},getFileSize:function(){return this.Size},SaveToFile:function(e){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(new Blob([this.Stream.subarray(0,this.Size)],{type:"application/pdf"}),e);else{var t=document.createElement("a");t.href=URL.createObjectURL(new Blob([this.Stream.subarray(0,this.Size)],{type:"application/pdf"})),t.download=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}},SaveToBlob:function(){return new Blob([this.Stream.subarray(0,this.Size)],{type:"application/pdf"})},SaveToBlobUrl:function(){return URL.createObjectURL(new Blob([this.Stream.subarray(0,this.Size)],{type:"application/pdf"}))}},TPDFAnalyst.prototype={LoadError:function(e){throw e},IsObjectID:function(e){var t=PDF_StrToIntDef(e,-1);return!(t<0||t>this.ObjectCount-1)},GetPointer:function(){throw PDFDESIGNER_ERROR_003},GetGenerationID:function(e){var t,r=-1;t=this.Stream.Pos,this.Stream.Pos=parseInt(this.ObjectPosArray[e],10);try{PDF_GetString(this.Stream),r=PDF_StrToIntDef(PDF_GetString(this.Stream),-1)}finally{this.Stream.Pos=t}return r},ObjectIndexCheck:function(e){null==this.Stream&&this.LoadError(PDFDESIGNER_ERROR_001),this.IsObjectID(e)||this.LoadError(PDFDESIGNER_ERROR_002)},GetObject:function(e){throw PDFDESIGNER_ERROR_003},GetObjectSize:function(e){var t,r,i=0,n=0;if(this.ObjectIndexCheck(e),this.DeleteObject[e])return n;for(r=this.Stream.Pos,this.Stream.Pos=parseInt(this.ObjectPosArray[e],10);;)if("%"==(t=PDF_GetString(this.Stream)))PDF_CommnetSkip(this.Stream);else if("("==t)PDF_TextSkip(this.Stream);else if("/Length"==t)i=this.GetObjectType_Integer();else if("stream"==t)"\r"==this.Stream.ReadString(1)&&this.Stream.ReadString(1),this.Stream.Pos=this.Stream.Pos+i;else if("endobj"==t)break;return n=this.Stream.Pos-parseInt(this.ObjectPosArray[e],10),this.Stream.Pos=r,n},GetObjectStream:function(e){var t=this.GetObjectSize(e),r=parseInt(this.ObjectPosArray[e],10),i=new TMemoryStream(this.Stream,r,r+t);return i.WriteString("\n"),i},GetInDeirect_Integer:function(e){var t,r,i=0;for(r=this.Stream.Pos,this.Stream.Pos=parseInt(this.ObjectPosArray[e],10),PDF_TopLineSkip(this.Stream);;)if(""!=(t=PDF_GetString(this.Stream)))if("%"==t)PDF_CommnetSkip(this.Stream);else{if(t[0].match(/[1-9]+/)){i=PDF_StrToIntDef(t,0);break}if("endobj"==t)break}return this.Stream.Pos=r,i},GetInDeirect_Array:function(e,t){var r,i,n=!1;if(i=this.Stream.Pos,this.Stream.Pos=parseInt(this.ObjectPosArray[e],10),PDF_TopLineSkip(this.Stream),"["!=(r=PDF_GetString(this.Stream)))return this.Stream.Pos=i,n;for(;"]"!=(r=PDF_GetString(this.Stream))&&"endobj"!=r&&(e=PDF_StrToIntDef(r,-1),this.IsObjectID(e)&&(t[t.length]=e),"]"!=(r=PDF_GetString(this.Stream))&&"endobj"!=r)&&"]"!=(r=PDF_GetString(this.Stream))&&"endobj"!=r;)n=!0;return this.Stream.Pos=i,n},GetInDeirect_ArrayofName:function(e,t){var r,i,n=!1;if(i=this.Stream.Pos,this.Stream.Pos=parseInt(this.ObjectPosArray[e],10),PDF_TopLineSkip(this.Stream),"["!=(r=PDF_GetString(this.Stream)))return this.Stream.Pos=i,n;for(;;)if(""!=(r=PDF_GetString(this.Stream))){if("]"==r||(r="endobj"))break;"/"==r[0]&&(n=!0,t[t.length]=r)}return this.Stream.Pos=i,n},GetObjectType_Integer:function(){var e,t,r,i,n,o=0;i=this.Stream.Pos;try{e=PDF_GetString(this.Stream),t=PDF_GetString(this.Stream),r=PDF_GetString(this.Stream),t.match(/[0-9]+/)&&"R"==r?(n=PDF_StrToIntDef(e,-1),o=this.IsObjectID(n)?this.GetInDeirect_Integer(n):0):o=PDF_StrToIntDef(e,0)}catch(e){o=0}return this.Stream.Pos=i,o},GetObjectType_Array:function(e){var t,r,i;if(i=this.Stream.Pos,"["==(t=PDF_GetString(this.Stream)))for(;"]"!=(t=PDF_GetString(this.Stream))&&"endobj"!=t&&(r=PDF_StrToIntDef(t,-1),this.IsObjectID(r)&&(e[e.length]=r),"]"!=(t=PDF_GetString(this.Stream))&&"endobj"!=t)&&"]"!=(t=PDF_GetString(this.Stream))&&"endobj"!=t;);else r=PDF_StrToIntDef(t,-1),this.IsObjectID(r)&&(this.GetInDeirect_Array(r,e)||(e[e.length]=r));this.Stream.Pos=i},GetObjectType_ArrayofName:function(e){var t,r,i;if(i=this.Stream.Pos,"["==(t=PDF_GetString(this.Stream)))for(;"]"!=(t=PDF_GetString(this.Stream))&&"endobj"!=t;)"/"==t[0]&&(e[e.length]=t);else"/"==t[0]?e[e.length]=t:t[0].match(/[1-9]+/)&&(r=PDF_StrToIntDef(t,-1),this.IsObjectID(r)&&this.GetInDeirect_ArrayofName(r,e));this.Stream.Pos=i},GetMediaBox:function(e){var t,r,i,n=!1,o=-1,a=0,s="";if(!this.IsObjectID(e))return s;for(i=this.Stream.Pos,this.Stream.Pos=parseInt(this.ObjectPosArray[e],10);;)if("%"==(r=PDF_GetString(this.Stream)))PDF_CommnetSkip(this.Stream);else if("/Parent"==r)o=PDF_StrToIntDef(r=PDF_GetString(this.Stream),-1);else{if("/MediaBox"==r){for(;s+=t=this.Stream.ReadString(1),"]"!=t;);n=!0;break}if("("==r)PDF_TextSkip(this.Stream);else if("/Length"==r)a=this.GetObjectType_Integer();else if("stream"==r)"\r"==(t=this.Stream.ReadString(1))&&(t=this.Stream.ReadString(1)),this.Stream.Pos=this.Stream.Pos+a;else if("endobj"==r)break}return n||-1==o||(s=this.GetMediaBox(o)),this.Stream.Pos=i,s},GetPageInfo:function(e){null==this.Stream&&this.LoadError(PDFDESIGNER_ERROR_005),-1==this.FirstPagesID&&this.LoadError(PDFDESIGNER_ERROR_006),null!=e&&function t(r,i){var n,o=new Array,a=0;try{for(r.Stream.Pos=parseInt(r.ObjectPosArray[i],10),n=PDF_GetString(r.Stream),parseInt(n,10)!=i&&r.LoadError(PDFDESIGNER_ERROR_004);;)if("%"==(n=PDF_GetString(r.Stream)))PDF_CommnetSkip(r.Stream);else if("/Kids"==n)r.GetObjectType_Array(o);else{if("/Page"==n){e[e.length]=i;break}if("("==n)PDF_TextSkip(r.Stream);else if("/Length"==n)a=r.GetObjectType_Integer();else if("stream"==n)"\r"==r.Stream.ReadString(1)&&r.Stream.ReadString(1),r.Stream.Pos=r.Stream.Pos+a;else if("endobj"==n)break}for(var s=0;s<o.length;s++)t(r,parseInt(o[s],10))}catch(e){}}(this,this.FirstPagesID)},GetFirstPageSize:function(){var e;this.FirstPageID=-1,function e(t,r){var i,n,o=new Array;n=0;try{for(t.Stream.Pos=parseInt(t.ObjectPosArray[r],10),i=PDF_GetString(t.Stream),parseInt(i,10)!=r&&t.LoadError(PDFDESIGNER_ERROR_004);;)if("%"==(i=PDF_GetString(t.Stream)))PDF_CommnetSkip(t.Stream);else if("/Kids"==i)t.GetObjectType_Array(o);else{if("/Page"==i){-1==t.FirstPageID&&(t.FirstPageID=r);break}if("("==i)PDF_TextSkip(t.Stream);else if("/Length"==i)n=t.GetObjectType_Integer();else if("stream"==i)"\r"==t.Stream.ReadString(1)&&t.Stream.ReadString(1),t.Stream.Pos=t.Stream.Pos+n;else if("endobj"==i)break}for(var a=0;a<o.length;a++)-1==t.FirstPageID&&e(t,parseInt(o[a],10))}catch(e){}}(this,this.FirstPagesID),-1!=this.FirstPageID&&(e=this.GetMediaBox(this.FirstPageID),this.PageSize=PDF_GetMediaBoxRect(e))},GetPageCount:function(){var e,t;for(t=this.Stream.Pos,this.Stream.Pos=parseInt(this.ObjectPosArray[this.FirstPagesID],10),e=PDF_GetString(this.Stream),parseInt(e,10)!=this.FirstPagesID&&this.LoadError(PDFDESIGNER_ERROR_004);;)if("%"==(e=PDF_GetString(this.Stream)))PDF_CommnetSkip(this.Stream);else if("/Count"==e)this.PageCount=this.GetObjectType_Integer();else if("endobj"==e)break;this.Stream.Pos=t},GetDocumentCatalogInfo:function(){var e,t,r,i;for(r=0,i=this.Stream.Pos,this.Stream.Pos=parseInt(this.ObjectPosArray[this.RootID],10),t=PDF_GetString(this.Stream),parseInt(t,10)!=this.RootID&&this.LoadError(PDFDESIGNER_ERROR_004);;)if("%"==(t=PDF_GetString(this.Stream)))PDF_CommnetSkip(this.Stream);else if("/StructTreeRoot"==t)this.Tag=!0;else if("/Outlines"==t)e=PDF_GetString(this.Stream),this.OutlinesID=PDF_StrToIntDef(e,-1);else if("/Pages"==t)e=PDF_GetString(this.Stream),this.FirstPagesID=PDF_StrToIntDef(e,-1);else if("/Metadata"==t)e=PDF_GetString(this.Stream),this.MetadataID=PDF_StrToIntDef(e,-1);else if("("==t)PDF_TextSkip(this.Stream);else if("/Length"==t)r=this.GetObjectType_Integer();else if("stream"==t)"\r"==(e=this.Stream.ReadString(1))&&(e=this.Stream.ReadString(1)),this.Stream.Pos=this.Stream.Pos+r;else if("endobj"==t)break;this.Stream.Pos=i},LoadFromFile:function(e){throw PDFDESIGNER_ERROR_003},LoadFromStream:function(e){var t,r,i;this.Stream=new TReadStream(e),this.Stream.FileSize<5&&this.LoadError(PDFDESIGNER_ERROR_014),"%PDF-"!=(i=this.Stream.ReadString(5))&&this.LoadError(PDFDESIGNER_ERROR_015),this.Version=PDF_GetString(this.Stream),this.Version.length<3&&this.LoadError(PDFDESIGNER_ERROR_015);for(var n=1;;){if(this.Stream.Pos=this.Stream.FileSize-n,"\n"!=(i=this.Stream.ReadString(1))&&"\r"!=i&&" "!=i){this.Stream.Pos=this.Stream.Pos-"%%EOF".length;break}n++}"%%EOF"!=(i=this.Stream.ReadString(5))&&this.LoadError(PDFDESIGNER_ERROR_016),this.Stream.Pos=this.Stream.Pos-5;for(var o="";this.Stream.Pos=this.Stream.Pos-1,"\n"==(i=this.Stream.ReadString(1))||"\r"==i||" "==i;)this.Stream.Pos=this.Stream.Pos-1;for(;this.Stream.Pos=this.Stream.Pos-1,"\n"!=(i=this.Stream.ReadString(1))&&"\r"!=i&&" "!=i;)this.Stream.Pos=this.Stream.Pos-1,o=i+o;o.match(/[^0-9]+/)&&this.LoadError(PDFDESIGNER_ERROR_017),function e(i,n){var o,a,s,S,P;for(i.XrefTableList[i.XrefTableList.length]=n,173==n&&(i.Optimize=!0),S=-1,i.Stream.Pos=parseInt(n,10),"xref"!=(o=i.Stream.ReadString(4))&&i.LoadError(PDFDESIGNER_ERROR_007);;){(r=PDF_GetString(i.Stream)).match(/[^0-9]+/)&&i.LoadError(PDFDESIGNER_ERROR_008),r=parseInt(r,10),(t=PDF_GetString(i.Stream)).match(/[^0-9]+/)&&i.LoadError(PDFDESIGNER_ERROR_009),t=parseInt(t,10),-1==i.ObjectCount?i.ObjectCount=r+t:r+t>i.ObjectCount&&(i.ObjectCount=r+t),PDF_SeekPos(i.Stream);for(var h=0;h<t;h++)a=i.Stream.ReadString(10),s=i.Stream.ReadString(8),"\r"!=(o=i.Stream.ReadString(1))&&" "!=o||"\n"!=(o=i.Stream.ReadString(1))&&"\r"!=o&&(i.Stream.Pos=i.Stream.Pos-1),null==i.ObjectPosArray[r+h]&&(a.match(/[^0-9]+/)&&i.LoadError(PDFDESIGNER_ERROR_009),i.ObjectPosArray[r+h]=a),"f"==s[7]?i.DeleteObject[r+h]=!0:i.DeleteObject[r+h]=!1;if(P=i.Stream.Pos,"trailer"==(o=PDF_GetString(i.Stream)))break;i.Stream.Pos=P}for(PDF_SeekPos(i.Stream),"<<"!=(o=i.Stream.ReadString(2))&&i.LoadError(PDFDESIGNER_ERROR_010);;)if("/Root"==(o=PDF_GetString(i.Stream)))o=PDF_GetString(i.Stream),-1==i.RootID&&(i.RootID=o,i.RootID.match(/[^0-9]+/)&&i.LoadError(PDFDESIGNER_ERROR_011),i.RootID=parseInt(i.RootID,10));else if("/Prev"==o)(S=o=PDF_GetString(i.Stream)).match(/[^0-9]+/)&&i.LoadError(PDFDESIGNER_ERROR_012),S=parseInt(S,10);else if("/Info"==o)o=PDF_GetString(i.Stream),-1==i.InfoID&&(i.InfoID=o,i.InfoID.match(/[^0-9]+/)&&i.LoadError(PDFDESIGNER_ERROR_013),i.InfoID=parseInt(i.InfoID,10));else if("/Encrypt"==o)i.Encrypt=!0;else if("startxref"==o)break;-1!=S&&e(i,S)}(this,parseInt(o,10)),-1==this.RootID&&this.LoadError(PDFDESIGNER_ERROR_018),this.GetDocumentCatalogInfo(),-1==this.FirstPagesID&&this.LoadError(PDFDESIGNER_ERROR_019),this.GetPageCount(),-1!=this.FirstPagesID&&this.GetFirstPageSize()}},TPDFParser.prototype={PDFPage_GetResourceStream:function(e,t){var r,i,n,o,a=!1,s=-1,S=0,P=null;if(!e.IsObjectID(t))return P;for(i=e.Stream.Pos,e.Stream.Pos=parseInt(e.ObjectPosArray[t],10);;)if("%"==(r=PDF_GetString(e.Stream)))PDF_CommnetSkip(e.Stream);else if("("==r)PDF_TextSkip(e.Stream);else if("/Parent"==r)s=PDF_StrToIntDef(r=PDF_GetString(e.Stream),-1);else{if("/Resources"==r){if("<"==(r=PDF_GetString(e.Stream)))e.Stream.Pos=e.Stream.Pos-1,n=e.Stream.Pos,PDF_DictionarySkip(e.Stream);else for(n=e.Stream.Pos-r.length;"R"!=(r=PDF_GetString(e.Stream)););o=e.Stream.Pos-n,e.Stream.Pos=n,P=new TMemoryStream(e.Stream,n,n+o),e.Stream.Pos=o,a=!0;break}if("/Length"==r)S=e.GetObjectType_Integer(e.Stream);else if("stream"==r)"\r"==e.Stream.ReadString(1)&&e.Stream.ReadString(1),e.Stream.Pos=e.Stream.Pos+S;else if("endobj"==r)break}return a||-1==s||(P=this.PDFPage_GetResourceStream(e,s)),e.Stream.Pos=i,P},PDFPage_GetContentsStream:function(e,t){var r,i,n,o,a=0,s=null;if(!e.IsObjectID(t))return s;for(i=e.Stream.Pos,e.Stream.Pos=parseInt(e.ObjectPosArray[t],10);;)if("%"==(r=PDF_GetString(e.Stream)))PDF_CommnetSkip(e.Stream);else if("("==r)PDF_TextSkip(e.Stream);else{if("/Contents"==r){if("["==(r=PDF_GetString(e.Stream)))e.Stream.Pos=e.Stream.Pos-1,n=e.Stream.Pos,PDF_ArraySkip(e.Stream);else for(n=e.Stream.Pos-r.length;"R"!=(r=PDF_GetString(e.Stream)););o=e.Stream.Pos-n,e.Stream.Pos=n,s=new TMemoryStream(e.Stream,n,n+o),e.Stream.Pos=o;break}if("/Length"==r)a=e.GetObjectType_Integer(e.Stream);else if("stream"==r)"\r"==e.Stream.ReadString(1)&&e.Stream.ReadString(1),e.Stream.Pos=e.Stream.Pos+a;else if("endobj"==r)break}return e.Stream.Pos=i,s},PDFPage_GetRotate:function(e,t){var r,i,n=!1,o=-1,a=0,s=0;if(!e.IsObjectID(t))return s;for(i=e.Stream.Pos,e.Stream.Pos=parseInt(e.ObjectPosArray[t],10);;)if("%"==(r=PDF_GetString(e.Stream)))PDF_CommnetSkip(e.Stream);else if("("==r)PDF_TextSkip(e.Stream);else if("/Parent"==r)o=PDF_StrToIntDef(r=PDF_GetString(e.Stream),-1);else{if("/Rotate"==r){s=PDF_StrToIntDef(PDF_GetString(e.Stream),0),n=!0;break}if("/Length"==r)a=e.GetObjectType_Integer(e.Stream);else if("stream"==r)"\r"==e.Stream.ReadString(1)&&e.Stream.ReadString(1),e.Stream.Pos=e.Stream.Pos+a;else if("endobj"==r)break}return n||-1==o||(s=this.PDFPage_GetRotate(e,o)),e.Stream.Pos=i,s},WriteDummyInfo:function(e,t){var r,i,n,o,a=new TMemoryStream(t,0,t.getFileSize());n=e.GetObjectSize(e.InfoID),a.Pos=parseInt(e.ObjectPosArray[e.InfoID],10),i=a.Pos,PDF_GetString(a),PDF_GetString(a),PDF_GetString(a),a.Stream[a.Pos+0]=10,a.Stream[a.Pos+1]=60,a.Stream[a.Pos+2]=60,a.Stream[a.Pos+3]=10,a.Pos=a.Pos+"\n<<\n".length,o=a.Pos-i,r="";for(var s=0;s<n-o;s++)a.Stream[a.Pos+s]=32,r+=" ";a.Pos=a.Pos+r.length,a.Pos=a.Pos-"\n>>\nendobj".length,a.Stream[a.Pos+0]=10,a.Stream[a.Pos+1]=62,a.Stream[a.Pos+2]=62,a.Stream[a.Pos+3]=10,a.Stream[a.Pos+4]=101,a.Stream[a.Pos+5]=110,a.Stream[a.Pos+6]=100,a.Stream[a.Pos+7]=111,a.Stream[a.Pos+8]=98,a.Stream[a.Pos+9]=106,t.Rewrite(a)},Write_ViewerPreferences:function(e,t){(t.ViewerPreferences.HideToolbar||t.ViewerPreferences.HideMenubar||t.ViewerPreferences.HideWindowUI||t.ViewerPreferences.Direction||t.ViewerPreferences.FitWindow||t.ViewerPreferences.CenterWindow||t.ViewerPreferences.DisplayDocTitle||t.PageMode==TPDFPageMode.pmFullScreen)&&(e.WriteString("/ViewerPreferences <<"),t.ViewerPreferences.HideToolbar&&e.WriteString(" /HideToolbar true"),t.ViewerPreferences.HideMenubar&&e.WriteString(" /HideMenubar true"),t.ViewerPreferences.HideWindowUI&&e.WriteString(" /HideWindowUI true"),t.ViewerPreferences.FitWindow&&e.WriteString(" /FitWindow true"),t.ViewerPreferences.CenterWindow&&e.WriteString(" /CenterWindow true"),t.ViewerPreferences.DisplayDocTitle&&e.WriteString(" /DisplayDocTitle true"),t.ViewerPreferences.Direction&&e.WriteString(" /Direction /R2L"),t.PageMode==TPDFPageMode.pmFullScreen&&(t.ViewerPreferences.NonFullScreenPageMode==TPDFPageMode.pmUseOutlines?e.WriteString(" /NonFullScreenPageMode /UseOutlines"):t.ViewerPreferences.NonFullScreenPageMode==TPDFPageMode.pmUseThumbs&&e.WriteString(" /NonFullScreenPageMode /UseThumbs")),e.WriteString(" >>\n"))},Write_PageLayout:function(e,t){t.PageLayout==TPDFPageLayout.plSinglePage?e.WriteString("/PageLayout /SinglePage\n"):t.PageLayout==TPDFPageLayout.plOneColumn?e.WriteString("/PageLayout /OneColumn\n"):t.PageLayout==TPDFPageLayout.plTwoColumnLeft?e.WriteString("/PageLayout /TwoColumnLeft\n"):t.PageLayout==TPDFPageLayout.plTwoColumnRight&&e.WriteString("/PageLayout /TwoColumnRight\n")},Write_PageMode:function(e,t){t.PageMode==TPDFPageMode.pmUseOutlines?e.WriteString("/PageMode /UseOutlines\n"):t.PageMode==TPDFPageMode.pmUseThumbs?e.WriteString("/PageMode /UseThumbs\n"):t.PageMode==TPDFPageMode.pmFullScreen&&e.WriteString("/PageMode /FullScreen\n")},WritePDFHedaer:function(e,t,r,i){var n,o=0;this._ObjectMem.ObjectPosArray[o]=e.getFileSize(),e.WriteString("1 0 obj\n"),e.WriteString("<<\n"),e.WriteString("/Type /Catalog\n"),e.WriteString("/Pages 2 0 R\n"),this.Write_ViewerPreferences(e,r),this.Write_PageMode(e,r),this.Write_PageLayout(e,r),n=parseInt(i,10),r.OpenAction.SubType==TPDFOpenActionType.oaXYZ?16==r.OpenAction.Zoom?e.WriteString("/OpenAction ["+n+" 0 R /XYZ -32768 -32768 16 ]\n"):8==r.OpenAction.Zoom?e.WriteString("/OpenAction ["+n+" 0 R /XYZ -32768 -32768 8 ]\n"):4==r.OpenAction.Zoom?e.WriteString("/OpenAction ["+n+" 0 R /XYZ -32768 -32768 4 ]\n"):2==r.OpenAction.Zoom?e.WriteString("/OpenAction ["+n+" 0 R /XYZ -32768 -32768 2 ]\n"):1.5==r.OpenAction.Zoom?e.WriteString("/OpenAction ["+n+" 0 R /XYZ -32768 -32768 1.5 ]\n"):1.25==r.OpenAction.Zoom?e.WriteString("/OpenAction ["+n+" 0 R /XYZ -32768 -32768 1.25 ]\n"):1==r.OpenAction.Zoom?e.WriteString("/OpenAction ["+n+" 0 R /XYZ -32768 -32768 1 ]\n"):.75==r.OpenAction.Zoom?e.WriteString("/OpenAction ["+n+" 0 R /XYZ -32768 -32768 0.75 ]\n"):.5==r.OpenAction.Zoom?e.WriteString("/OpenAction ["+n+" 0 R /XYZ -32768 -32768 0.5 ]\n"):.25==r.OpenAction.Zoom&&e.WriteString("/OpenAction ["+n+" 0 R /XYZ -32768 -32768 0.25 ]\n"):r.OpenAction.SubType==TPDFOpenActionType.oaFitBH?e.WriteString("/OpenAction ["+n+" 0 R /FitBH -32768 ]\n"):r.OpenAction.SubType==TPDFOpenActionType.oaFit?e.WriteString("/OpenAction ["+n+" 0 R /Fit]\n"):r.OpenAction.SubType==TPDFOpenActionType.oaFitH?e.WriteString("/OpenAction ["+n+" 0 R /FitH -32768]\n"):n!=parseInt(i,10)&&e.WriteString("/OpenAction ["+n+" 0 R /XYZ null null null ]\n"),e.WriteString(">>\n"),e.WriteString("endobj\n"),o++,this._ObjectMem.ObjectPosArray[o]=e.getFileSize(),e.WriteString("2 0 obj\n"),e.WriteString("<<\n"),e.WriteString("/Type /Pages\n"),e.WriteString("/Kids [");for(o=0;o<this._PageList.length;o++)e.WriteString(" "+this._PageList[o]+" 0 R");e.WriteString(" ]\n"),e.WriteString("/Count "+this._PageList.length+"\n"),e.WriteString(">>\n"),e.WriteString("endobj\n")},WritePDFHedaer_Maker:function(e,t,r,i,n){var o,a;function s(){var r;e.Stream.Pos!=o&&(r=e.Stream.Pos,e.Stream.Pos=o,t.WriteStream(e.Stream,o,r),e.Stream.Pos=e.Stream.Pos+(r-o))}function S(){var r,n;r=-1!=i.OpenAction.ObjectID?parseInt(i.OpenAction.ObjectID,10):e.FirstPageID,n=e.GetGenerationID(r),i.OpenAction.SubType==TPDFOpenActionType.oaXYZ?16==i.OpenAction.Zoom?t.WriteString("/OpenAction ["+r+" "+n+" R /XYZ -32768 -32768 16 ]\n"):8==i.OpenAction.Zoom?t.WriteString("/OpenAction ["+r+" "+n+" R /XYZ -32768 -32768 8 ]\n"):4==i.OpenAction.Zoom?t.WriteString("/OpenAction ["+r+" "+n+" R /XYZ -32768 -32768 4 ]\n"):2==i.OpenAction.Zoom?t.WriteString("/OpenAction ["+r+" "+n+" R /XYZ -32768 -32768 2 ]\n"):1.5==i.OpenAction.Zoom?t.WriteString("/OpenAction ["+r+" "+n+" R /XYZ -32768 -32768 1.5 ]\n"):1.25==i.OpenAction.Zoom?t.WriteString("/OpenAction ["+r+" "+n+" R /XYZ -32768 -32768 1.25 ]\n"):1==i.OpenAction.Zoom?t.WriteString("/OpenAction ["+r+" "+n+" R /XYZ -32768 -32768 1 ]\n"):.75==i.OpenAction.Zoom?t.WriteString("/OpenAction ["+r+" "+n+" R /XYZ -32768 -32768 0.75 ]\n"):.5==i.OpenAction.Zoom?t.WriteString("/OpenAction ["+r+" "+n+" R /XYZ -32768 -32768 0.5 ]\n"):.25==i.OpenAction.Zoom&&t.WriteString("/OpenAction ["+r+" "+n+" R /XYZ -32768 -32768 0.25 ]\n"):i.OpenAction.SubType==TPDFOpenActionType.oaFitBH?t.WriteString("/OpenAction ["+r+" "+n+" R /FitBH -32768 ]\n"):i.OpenAction.SubType==TPDFOpenActionType.oaFit?t.WriteString("/OpenAction ["+r+" "+n+" R /Fit]\n"):i.OpenAction.SubType==TPDFOpenActionType.oaFitH?t.WriteString("/OpenAction ["+r+" "+n+" R /FitH -32768]\n"):r!=e.FirstPageID&&t.WriteString("/OpenAction ["+r+" "+n+" R /XYZ null null null ]\n")}function P(){t.WriteString("/Outlines "+(e.ObjectPosArray.length+1)+" 0 R\n")}function h(t){for(;t!=PDF_GetString(e.Stream););}var c=!1,g=!1,l=!1,m=!1,D=!1;for(e.Stream.Pos=parseInt(e.ObjectPosArray[e.RootID],10),r.ObjectPosArray[r.ObjectIndex]=t.Pos,PDF_TopLineSkip(e.Stream),t.WriteString(r.ObjectIndex+1+" 0 obj\n");;)if(o=e.Stream.Pos,""!=(a=PDF_GetString(e.Stream)))if("%"!=a){if("("==a)PDF_TextSkip(e.Stream);else{if("/OpenAction"==a){e.Stream.Pos=e.Stream.Pos-"/OpenAction".length,s(),S(),e.Stream.Pos=e.Stream.Pos+"/OpenAction".length,"["==(a=PDF_GetString(e.Stream))?PDF_ArraySkip(e.Stream):a[0].match(/[1-9]+/)?h("R"):"<"==a&&(e.Stream.Pos=e.Stream.Pos+1,PDF_DictionarySkip(e.Stream)),c=!0;continue}if("/PageMode"==a){e.Stream.Pos=e.Stream.Pos-"/PageMode".length,s(),this.Write_PageMode(t,i),e.Stream.Pos=e.Stream.Pos+"/PageMode".length,PDF_NameSkip(e.Stream),g=!0;continue}if("/PageLayout"==a){e.Stream.Pos=e.Stream.Pos-"/PageLayout".length,s(),this.Write_PageLayout(t,i),e.Stream.Pos=e.Stream.Pos+"/PageLayout".length,PDF_NameSkip(e.Stream),l=!0;continue}if("/ViewerPreferences"==a){e.Stream.Pos=e.Stream.Pos-"/ViewerPreferences".length,s(),this.Write_ViewerPreferences(t,i),e.Stream.Pos=e.Stream.Pos+"/ViewerPreferences".length,(a=PDF_GetString(e.Stream))[0].match(/[1-9]+/)?h("R"):"<"==a&&(e.Stream.Pos=e.Stream.Pos-1,PDF_DictionarySkip(e.Stream)),m=!0;continue}if("/Outlines"==a){if(n){e.Stream.Pos=e.Stream.Pos-"/Outlines".length,s(),P(),e.Stream.Pos=e.Stream.Pos+"/Outlines".length,h("R"),D=!0;continue}}else if("endobj"==a){if(s(),!c||!g||!D&&n||!l||!m){var f=new TMemoryStream(t,0,t.getFileSize());for(f.Pos=f.getFileSize(),f.Pos=f.Pos-"endobj".length;;){if(">"==f.ReadString(1)){f.Pos=f.Pos-2,f.Stream=f.Stream.subarray(0,f.Pos);break}f.Pos=f.Pos-2}t.Rewrite(f),t.WriteString("\n"),c||S(),g||this.Write_PageMode(t,i),!D&&n&&P(),l||this.Write_PageLayout(t,i),m||this.Write_ViewerPreferences(t,i),t.WriteString(">>\n"),t.WriteString("endobj")}break}}s()}else PDF_CommnetSkip(e.Stream);t.WriteString("\n"),r.ObjectIndex++},WriteInfo:function(e,t,r){var i=new TPDFCode;t.ObjectPosArray[t.ObjectIndex]=e.getFileSize(),e.WriteString(t.ObjectIndex+1+" 0 obj\n"),e.WriteString("<<\n"),""!=r.Author&&e.WriteString("/Author ("+i.PDFDocEncoding(r.Author)+")\n"),""!=r.Title&&e.WriteString("/Title ("+i.PDFDocEncoding(r.Title)+")\n"),""!=r.Subject&&e.WriteString("/Subject ("+i.PDFDocEncoding(r.Subject)+")\n"),""!=r.Keywords&&e.WriteString("/Keywords ("+i.PDFDocEncoding(r.Keywords)+")\n"),""!=r.Creator&&e.WriteString("/Creator ("+i.PDFDocEncoding(r.Creator)+")\n"),""!=r.Producer&&e.WriteString("/Producer ("+i.PDFDocEncoding(r.Producer)+")\n"),""!=r.CreationDate&&e.WriteString("/CreationDate ("+r.CreationDate+")\n"),""!=r.ModDate&&e.WriteString("/ModDate ("+r.ModDate+")\n"),e.WriteString(">>\n"),e.WriteString("endobj\n"),t.ObjectIndex++},WritePDFFooter:function(e,t){this.WriteInfo(e,this._ObjectMem,t),function(t){t.ObjectPosArray[t.ObjectIndex]=e.getFileSize(),e.WriteString("xref\n"),e.WriteString("0 "+(t.ObjectIndex+1)+"\n"),e.WriteString("0000000000 65535 f \n");for(var r=0;r<t.ObjectIndex;r++)e.WriteString(PDF_ConvertObjectPos([t.ObjectPosArray[r]],10)+" 00000 n \n")}(this._ObjectMem),e.WriteString("trailer\n"),e.WriteString("<<\n"),e.WriteString("/Size "+(this._ObjectMem.ObjectIndex+1)+"\n"),e.WriteString("/Info "+this._ObjectMem.ObjectIndex+" 0 R\n"),e.WriteString("/Root 1 0 R\n"),e.WriteString(">>\n"),e.WriteString("startxref\n"),e.WriteString(this._ObjectMem.ObjectPosArray[this._ObjectMem.ObjectIndex]+"\n"),e.WriteString("%%EOF\n")},WritePDFFooter_Maker:function(e,t,r,i){this.WriteInfo(t,r,i),function(){r.ObjectPosArray[r.ObjectIndex]=t.getFileSize(),t.WriteString("xref\n"),t.WriteString(e.ObjectPosArray.length+" "+(r.ObjectIndex+1-e.ObjectPosArray.length)+"\n");for(var i=e.ObjectPosArray.length-1;i<r.ObjectIndex;i++)t.WriteString(PDF_ConvertObjectPos([r.ObjectPosArray[i]],10)+" 00000 n \n")}(),t.WriteString("trailer\n"),t.WriteString("<<\n"),t.WriteString("/Size "+(r.ObjectIndex+1)+"\n"),t.WriteString("/Info "+r.ObjectIndex+" 0 R\n"),t.WriteString("/Root "+e.ObjectPosArray.length+" 0 R\n"),t.WriteString("/Prev "+e.XrefTableList[0]+"\n"),t.WriteString(">>\n"),t.WriteString("startxref\n"),t.WriteString(r.ObjectPosArray[r.ObjectIndex]+"\n"),t.WriteString("%%EOF\n")},GetPageInObjectList:function(e,t,r){function i(e){for(var t=!1,i=new Array,n=e.length,o=r.length,a=0;a<n;a++){t=!1;for(var s=0;s<o;s++)if(r[s]==e[a]){t=!0;break}t||(i[i.length]=e[a])}return i}function n(t,r){var i,n,o,a,s=0;try{for(;;)if(""!=(i=PDF_GetString(t)))if("%"!=i){if("("==i)PDF_TextSkip(t);else if(i[0].match(/[1-9]+/))try{if(a=t.Pos,"endobj"==(n=PDF_GetString(t)))break;if("endobj"==(o=PDF_GetString(t)))break;if(-1!=PDF_StrToIntDef(n,-1)&&"R"==o){if(!e.IsObjectID(i)){t.Pos=a;continue}r[r.length]=parseInt(i,10)}else t.Pos=a}catch(e){break}else if("/Length"==i)s=e.GetObjectType_Integer(t);else if("stream"==i)"\r"==t.ReadString(1)&&t.ReadString(1),t.Stream.Pos=t.Stream.Pos+s;else if("endobj"==i)break}else PDF_CommnetSkip(t)}catch(e){}}function o(t){var n,a,s,S,P,h,c=0,g=new Array;h=e.Stream.Pos,e.Stream.Pos=parseInt(e.ObjectPosArray[t],10);try{for(;;)if(""!=(n=PDF_GetString(e.Stream)))if("%"!=n){if("("==n)PDF_TextSkip(e.Stream);else if(n[0].match(/[1-9]+/))try{if(P=e.Stream.Pos,"endobj"==(a=PDF_GetString(e.Stream)))break;if("endobj"==(s=PDF_GetString(e.Stream)))break;if(-1!=PDF_StrToIntDef(a,-1)&&"R"==s){if("/Parent"==S){e.Stream.Pos=P;continue}if(!e.IsObjectID(n)){e.Stream.Pos=P;continue}g[g.length]=parseInt(n,10)}else e.Stream.Pos=P}catch(e){break}else if("/Length"==n)c=e.GetObjectType_Integer(e.Stream);else if("stream"==n)"\r"==e.Stream.ReadString(1)&&e.Stream.ReadString(1),e.Stream.Pos=e.Stream.Pos+c;else if("endobj"==n)break;S=n}else PDF_CommnetSkip(e.Stream);if(0!=(g=i(g)).length)for(var l=g.length,m=0;m<l;m++)r[r.length]=g[m],o(parseInt(g[m],10))}finally{e.Stream.Pos=h}}var a=null,s=new Array;try{if(null!=(a=this.PDFPage_GetResourceStream(e,t))&&(a.WriteString("\n endobj\n"),a.Pos=0,n(a,s)),null!=(a=this.PDFPage_GetContentsStream(e,t))&&(a.WriteString("\n endobj\n"),a.Pos=0,n(a,s)),0!=(s=i(s)).length)for(var S=s.length,P=0;P<S;P++)r[r.length]=s[P],o(parseInt(s[P],10))}finally{}},WritePDFPage:function(e,t,r,i,n){function o(e){for(var t=parseInt(e,10),r=-1,o=i.length,a=0;a<o;a++)if(t==i[a]){r=a+n;break}return r}function a(t){var i,n,a,s,S,P;function h(){var e;(e=t.Pos)!=i&&(t.Pos=i,r.WriteStream(t,i,e),t.Pos=e)}var c=0;for(t.WriteString("\nendobj\n"),t.Pos=0;;)if(i=t.Pos,""!=(n=PDF_GetString(t)))if("%"!=n){if("("==n)PDF_TextSkip(t);else if(n[0].match(/[1-9]+/))try{if(S=t.Pos,"endobj"==(a=PDF_GetString(t)))break;if("endobj"==(s=PDF_GetString(t)))break;if(-1!=PDF_StrToIntDef(a,-1)&&"R"==s){if(!e.IsObjectID(n)){t.Pos=S;continue}P=t.Pos,t.Pos=S-n.length,h(),r.WriteString(o(n)+" 0 R"),t.Pos=P;continue}t.Pos=S}catch(e){break}else if("/Length"==n)c=e.GetObjectType_Integer(t);else if("stream"==n)"\r"==t.ReadString(1)&&t.ReadString(1),t.Pos=t.Pos+c;else if("endobj"==n)break;h()}else PDF_CommnetSkip(t)}var s=this.PDFPage_GetRotate(e,t),S=e.GetMediaBox(t),P=this.PDFPage_GetContentsStream(e,t),h=this.PDFPage_GetResourceStream(e,t);this._ObjectMem.ObjectPosArray[this._ObjectMem.ObjectIndex]=r.getFileSize();try{r.WriteString(this._ObjectMem.ObjectIndex+1+" 0 obj\n"),this._PageList[this._PageList.length]=this._ObjectMem.ObjectIndex+1+"",r.WriteString("<<\n"),r.WriteString("/Type /Page\n"),r.WriteString("/Parent 2 0 R\n"),""!=S&&r.WriteString("/MediaBox "+S+"\n"),null!=h&&(r.WriteString("/Resources "),a(h),r.WriteString("\n")),null!=P&&(r.WriteString("/Contents "),a(P),r.WriteString("\n")),r.WriteString("/Rotate "+s+"\n"),r.WriteString(">>\n"),r.WriteString("endobj\n"),this._ObjectMem.ObjectIndex++}finally{}},WritePDFObject:function(e,t,r,i,n){var o,a,s,S,P;function h(){var t;(t=e.Stream.Pos)!=o&&(e.Stream.Pos=o,r.WriteStream(e.Stream,o,t),e.Stream.Pos=t)}function c(t){var o;o=e.Stream.Pos,e.Stream.Pos=a-t.length,h(),r.WriteString(function(e){for(var t=parseInt(e,10),r=-1,o=i.length,a=0;a<o;a++)if(t==i[a]){r=a+n;break}return r}(t)+" 0 R"),e.Stream.Pos=o}var g=e.Stream.Pos,l=0;o=e.Stream.Pos,e.Stream.Pos=parseInt(e.ObjectPosArray[t],10),this._ObjectMem.ObjectPosArray[this._ObjectMem.ObjectIndex]=r.getFileSize(),PDF_TopLineSkip(e.Stream),r.WriteString(this._ObjectMem.ObjectIndex+1+" 0 obj\n");try{for(;;)if(o=e.Stream.Pos,""!=(s=PDF_GetString(e.Stream))){if("("==s)PDF_TextSkip(e.Stream);else{if("%"==s){PDF_CommnetSkip(e.Stream);continue}if(s[0].match(/[1-9]+/))try{if(a=e.Stream.Pos,"endobj"==(S=PDF_GetString(e.Stream))){h();break}if("endobj"==(P=PDF_GetString(e.Stream))){h();break}if(-1!=PDF_StrToIntDef(S,-1)&&"R"==P){if(!e.IsObjectID(s)){e.Stream.Pos=a;continue}c(s);continue}e.Stream.Pos=a}catch(e){break}else if("/Length"==s)l=e.GetObjectType_Integer(e.Stream);else if("stream"==s)"\r"==e.Stream.ReadString(1)&&e.Stream.ReadString(1),e.Stream.Pos=e.Stream.Pos+l;else if("endobj"==s){h();break}}h()}r.WriteString("\n"),this._ObjectMem.ObjectIndex++}finally{e.Stream.Pos=g}}},TPDFCode.prototype={SwapEndian:function(e){for(var t,r=0;r<e.length;r++)t=(255&e[r])<<8,e[r]=t+((65280&e[r])>>8)},IntToHex:function(e){var t=e.toString(16).toUpperCase();return 1==t.length?"0"+t:t},IsHex:function(e){var t=e.charCodeAt(0);return t>=65&&t<=70||t>=97&&t<=102||t>=48&&t<=57},RoundoByte:function(e){return e>255?255:e},DecimalCharToByte:function(e){return e.match(/[0-9]+/)?e.charCodeAt(0)-48:0},ByteToOctalStr:function(e){return""+((192&e)>>6)+((56&e)>>3)+(7&e)},OctalStrToByte:function(e){var t,r,i,n,o=this.RoundoByte(e.length);return 0==o?0:(1==o?(t="0",r="0",a3=e[0]):2==o?(t="0",r=e[0],a3=e[1]):(t=e[0],r=e[1],a3=e[2]),i=this.DecimalCharToByte(t),n=this.DecimalCharToByte(r),b3=this.DecimalCharToByte(a3),(i<<6)+(n<<3)+b3)},OctalStrToByteHexStr:function(e){return this.IntToHex(this.OctalStrToByte(e))},ReMoveEscape:function(e){for(var t=Array(),r=0,i=0;i<e.length;i++)92==r&&92==e[i]||92==r&&40==e[i]||92==r&&41==e[i]||92==r&&10==e[i]||92==r&&13==e[i]||92==r&&9==e[i]||92==r&&8==e[i]||92==r&&12==e[i]?t[t.length-1]=e[i]:t[t.length]=e[i],r=e[i];return t},PByteArrayToUnicode:function(e){var t,r=0,i=e.length,n=new Array;for(i%2!=0&&i--;t=e[r],r++,n[n.length]=t<<8|e[r],r!=i&&++r!=i;);return String.fromCharCode.apply(null,n)},AsciiHexEncoding:function(e){for(var t,r="",i=0;i<e.length;i++)r+=(t=e.charCodeAt(i))>=256?this.IntToHex(t):"00"+this.IntToHex(t);return r},AsciiHexDeccoding:function(e){var t,r=0,i=new Array;if(""==e)return i;for(;;){if(this.IsHex(e[r])){if(t=e[r],++r==e.length)break;this.IsHex(e[r])&&(i[i.length]=parseInt(t+e[r],16))}if(++r==e.length)break}return i},PDFDocEncoding:function(e){for(var t,r,i=new Array,n="",o=0;o<e.length;o++)i[i.length]=e.charCodeAt(o);this.SwapEndian(i);for(o=0;o<i.length;o++)t=(65280&i[o])>>8,(r=255&i[o])>=32&&r<=127?n+=92==r?"\\\\":40==r?"\\(":41==r?"\\)":String.fromCharCode(r):n=n+"\\"+this.ByteToOctalStr(r),t>=32&&t<=127?n+=92==t?"\\\\":40==t?"\\(":41==t?"\\)":String.fromCharCode(t):n=n+"\\"+this.ByteToOctalStr(t);return""!=n&&(n="\\376\\377"+n),n},PDFDocDecoding:function(e,t){var r,i,n,o,a="",s=0;if(""==e)return"";for((r=e).length>=8&&"\\376\\377"==r.slice(0,8)&&(s=8);;){if("\\"==r[s]){if(++s==r.length)break;if("\\"==r[s])a+=92..toString(16).toUpperCase();else if("("==r[s])a+=40..toString(16).toUpperCase();else if(")"==r[s])a+=41..toString(16).toUpperCase();else if("n"==r[s])a+=10..toString(16).toUpperCase();else if("r"==r[s])a+=13..toString(16).toUpperCase();else if("t"==r[s])a+=9..toString(16).toUpperCase();else if("b"==r[s])a+=8..toString(16).toUpperCase();else if("f"==r[s])a+=12..toString(16).toUpperCase();else if("\n"==r[s]||"\r"==r[s])"\r"==r[s]&&"\n"!=r[++s]&&s--;else if(r[s].match(/[0-9]+/)){if(i=r[s],++s==r.length){a+=this.OctalStrToByteHexStr(i);break}if(!r[s].match(/[0-9]+/)){a+=this.OctalStrToByteHexStr(i);continue}if(n=r[s],++s==r.length){a+=this.OctalStrToByteHexStr(i+n);break}if(!r[s].match(/[0-9]+/)){a+=this.OctalStrToByteHexStr(i+n);continue}o=r[s],a+=this.OctalStrToByteHexStr(i+n+o)}}else a+=this.IntToHex(r[s].charCodeAt(0));if(++s==r.length)break}return t?String.fromCharCode.apply(null,this.AsciiHexDeccoding(a)):this.PByteArrayToUnicode(this.AsciiHexDeccoding(a))},GetPDFTextStream:function(e){for(var t,r,i,n,o,a,s=new Array,S=!1;;){if(null==(t=e.Read(1)[0])||null==t)return;if(40==t){S=!1;break}if(60==t){S=!0;break}}for(;;){if(null==(t=e.Read(1)[0])||null==t)return;if(92==t){if(null==(r=e.Read(1)[0])||null==r)return;s[s.length]=t,s[s.length]=r}else if(41==t||62==t){if(41==t&&!S||62==t&&S)break;s[s.length]=t}else s[s.length]=t}return s.length<2?this.PDFDocDecoding(String.fromCharCode.apply(null,s),!0):(i=s[0],n=s[1],254==i&&255==n?this.PByteArrayToUnicode(this.ReMoveEscape(s).slice(2)):(i=String.fromCharCode(s[0]),n=String.fromCharCode(s[1]),"\\"==i&&"3"==n?this.PDFDocDecoding(String.fromCharCode.apply(null,s),!1):"\\"==i?this.PDFDocDecoding(String.fromCharCode.apply(null,s),!0):s.length<4?this.PDFDocDecoding(String.fromCharCode.apply(null,s),!0):(i=String.fromCharCode(s[0]).toUpperCase(),n=String.fromCharCode(s[1]).toUpperCase(),o=String.fromCharCode(s[2]).toUpperCase(),a=String.fromCharCode(s[3]).toUpperCase(),"F"==i&&"E"==n&&"F"==o&&"F"==a?this.PByteArrayToUnicode(this.ReMoveEscape(this.AsciiHexDeccoding(String.fromCharCode.apply(null,s))).slice(2)):this.PDFDocDecoding(String.fromCharCode.apply(null,s),!0))))}},TPDFDocInfo.prototype={DateTimeToStr:function(e){var t,r,i,n,o,a,s;return e.length>=14?(t=e.slice(0,4),r=e.slice(4,6),i=e.slice(6,8),n=e.slice(8,10),o=e.slice(10,12),a=e.slice(12,14),(s=PDF_StrToIntDef(t,-1))>=0&&s<=9999||(t="2000"),s=PDF_StrToIntDef(r,-1),r>=1&&r<=12||(r="01"),s=PDF_StrToIntDef(i,-1),i>=1&&i<=31||(i="01"),s=PDF_StrToIntDef(n,-1),n>=0&&n<=23||(n="00"),s=PDF_StrToIntDef(o,-1),o>=0&&o<=59||(o="00"),s=PDF_StrToIntDef(a,-1),a>=0&&a<=59||(a="00"),t+r+i+n+o+a):""},GetPDFDateStream:function(e){for(var t,r="";")"!=(t=e.ReadString(1));)(t.match(/[0-9]+/)||"+"==t||"-"==t||"z"==t||"Z)"==t||"'"==t)&&(r+=t);return r},GetPDFDocInfo:function(e){var t,r,i,n=new TPDFCode;if(e.Encrypt&&e.LoadError(PDFDESIGNER_ERROR_025),e.IsObjectID(e.InfoID)){if(e.DeleteObject[e.InfoID])return;for(PDF_TopLineSkip(i=e.GetObjectStream(e.InfoID));;)if(""!=(t=PDF_GetString(i)))if("/Title"==t){if(null==(r=n.GetPDFTextStream(i)))break;this.Title=r}else if("/Subject"==t){if(null==(r=n.GetPDFTextStream(i)))break;this.Subject=r}else if("/Author"==t){if(null==(r=n.GetPDFTextStream(i)))break;this.Author=r}else if("/Keywords"==t){if(null==(r=n.GetPDFTextStream(i)))break;this.Keywords=r}else if("/Creator"==t){if(null==(r=n.GetPDFTextStream(i)))break;this.Creator=r}else if("/Producer"==t){if(null==(r=n.GetPDFTextStream(i)))break;this.Producer=r}else if("/ModDate"==t){if(null==(r=n.GetPDFTextStream(i)))break;this.ModDate=r}else if("/CreationDate"==t){if(null==(r=n.GetPDFTextStream(i)))break;this.CreationDate=r}else if("/Trapped"==t)"/True"==(t=PDF_GetString(i))&&(this.Trapped=!0),"/False"==t&&(this.Trapped=!1),"/Unknown"==t&&(this.Trapped=!1);else if("("==t)PDF_TextSkip(i);else if("%"==t)PDF_CommnetSkip(i);else if("endobj"==t)break}}};var TPDFPageLayout={plDefault:0,plSinglePage:1,plOneColumn:2,plTwoColumnLeft:3,plTwoColumnRight:4},TPDFPageMode={pmDefault:0,pmUseNone:1,pmUseOutlines:2,pmUseThumbs:3,pmFullScreen:4},TPDFOpenActionType={oaDefault:0,oaXYZ:1,oaFit:2,oaFitH:3,oaFitV:4,oaFitR:5,oaFitB:6,oaFitBH:7,oaFitBV:8};function TPDFOpenAction(){this.Left=-1,this.Top=-1,this.Right=-1,this.Bottom=-1,this.Zoom=-1,this.ObjectID=-1,this.GenerationID=-1,this.SubType=TPDFOpenActionType.oaDefault}function TPDFViewerPreferences(){this.HideToolbar=!1,this.HideMenubar=!1,this.HideWindowUI=!1,this.FitWindow=!1,this.CenterWindow=!1,this.Direction=!1,this.DisplayDocTitle=!1,this.NonFullScreenPageMode=TPDFPageMode.pmDefault}function TPDFDocView(){this.PageMode=TPDFPageMode.pmDefault,this.PageLayout=TPDFPageLayout.plDefault,this.OpenAction=new TPDFOpenAction,this.ViewerPreferences=new TPDFViewerPreferences}function TPDFCombine(){this._BassID=0,this._PageList=new Array,this._ObjectMem=new TPDFObjMemManager,this.Info=new TPDFDocInfo,this.View=new TPDFDocView}function TPDFKnife(){this._BassID=0,this._PageList=new Array,this._ObjectMem=new TPDFObjMemManager,this.Info=new TPDFDocInfo,this.View=new TPDFDocView}function TPDFDeletePage(){this._BassID=0,this._PageList=new Array,this._ObjectMem=new TPDFObjMemManager,this.Info=new TPDFDocInfo,this.View=new TPDFDocView}function TPDFRotatePage(){this._ObjectMem=new TPDFObjMemManager}function TPDFInfoMaker(){this._ObjectMem=new TPDFObjMemManager,this.Info=new TPDFDocInfo,this.View=new TPDFDocView}function TPDFNode(e,t,r,i,n,o,a,s,S){this._ID,this.Page=i,this.ShowPos=n,this.Caption=r,this.URL=o,this.Level=t,this.Italic=s,this.Bold=a,this.Color=S,this.Parent=e,this.ChildNodes=new TPDFNodeList}function TPDFNodeList(){this._list=new Array}function TPDFOutLineManager(){this._PageList=new Array,this.Node=new TPDFNodeList}function TPDFOutLineMaker(){this._ObjectMem=new TPDFObjMemManager,this.Info=new TPDFDocInfo,this.View=new TPDFDocView,this.OutLine=new TPDFOutLineManager}TPDFOpenAction.prototype={Assign:function(e){this.Left=e.Left,this.Top=e.Top,this.Right=e.Right,this.Bottom=e.Bottom,this.Zoom=e.Zoom,this.ObjectID=e.ObjectID,this.GenerationID=e.GenerationID,this.SubType=e.SubType}},TPDFViewerPreferences.prototype={Assign:function(e){this.HideToolbar=e.HideToolbar,this.HideMenubar=e.HideMenubar,this.HideWindowUI=e.HideWindowUI,this.FitWindow=e.FitWindow,this.CenterWindow=e.CenterWindow,this.Direction=e.Direction,this.DisplayDocTitle=e.DisplayDocTitle,this.NonFullScreenPageMode=e.NonFullScreenPageMode}},TPDFDocView.prototype={Assign:function(e){this.PageMode=e.PageMode,this.PageLayout=e.PageLayout,this.OpenAction=e.OpenAction,this.ViewerPreferences=e.ViewerPreferences},GetDeirect_ViewerPreferences:function(e){var t;function r(e){return"true"==e.toLowerCase()}for(;;)if(""!=(t=PDF_GetString(e)))if("/"==t[0])"/HideToolbar"==t?this.ViewerPreferences.HideToolbar=r(PDF_GetString(e)):"/HideMenubar"==t?this.ViewerPreferences.HideMenubar=r(PDF_GetString(e)):"/HideWindowUI"==t?this.ViewerPreferences.HideWindowUI=r(PDF_GetString(e)):"/FitWindow"==t?this.ViewerPreferences.FitWindow=r(PDF_GetString(e)):"/CenterWindow"==t?this.ViewerPreferences.CenterWindow=r(PDF_GetString(e)):"/DisplayDocTitle"==t?this.ViewerPreferences.DisplayDocTitle=r(PDF_GetString(e)):"/NonFullScreenPageMode"==t?(t=PDF_GetString(e),this.ViewerPreferences.NonFullScreenPageMode="/UseNone"==t?TPDFPageMode.pmUseNone:"/UseOutlines"==t?TPDFPageMode.pmUseOutlines:"/UseThumbs"==t?TPDFPageMode.pmUseThumbs:TPDFPageMode.pmDefault):"/Direction"!=t&&"/PageDirection"!=t||"/R2L"==(t=PDF_GetString(e))&&(this.ViewerPreferences.Direction=!0);else if("("==t)PDF_TextSkip(e);else if("%"==t)PDF_CommnetSkip(e);else if(">"==t)break},GetInDeirect_ViewerPreferences:function(e,t){var r,i;i=e.Stream.Pos,e.Stream.Pos=parseInt(e.ObjectPosArray[t],10);try{for(PDF_TopLineSkip(e.Stream);;)if("%"==(r=PDF_GetString(e.Stream)))PDF_CommnetSkip(e.Stream);else{if("<"==r){e.Stream.Pos=e.Stream.Pos+1,this.GetDeirect_ViewerPreferences(e.Stream);break}if("endobj"==r)break}}finally{e.Stream.Pos=i}},GetDeirect_OpenAction_Array:function(e){var t;"("==(t=PDF_GetString(e))?PDF_TextSkip(e):t[0].match(/[1-9]+/)&&(this.OpenAction.ObjectID=PDF_StrToIntDef(t,-1),this.OpenAction.GenerationID=PDF_StrToIntDef(PDF_GetString(e),-1),"R"!=PDF_GetString(e)&&(this.OpenAction.ObjectID=-1,this.OpenAction.GenerationID=-1),"/Fit"==(t=PDF_GetString(e))?this.OpenAction.SubType=TPDFOpenActionType.oaFit:"/FitH"==t?(this.OpenAction.SubType=TPDFOpenActionType.oaFitH,this.OpenAction.Top=PDF_StrToFloatDef(PDF_GetString(e),-1)):"/FitV"==t?(this.OpenAction.SubType=TPDFOpenActionType.oaFitV,this.OpenAction.Left=PDF_StrToFloatDef(PDF_GetString(e),-1)):"/FitR"==t?(this.OpenAction.SubType=TPDFOpenActionType.oaFitR,this.OpenAction.Left=PDF_StrToFloatDef(PDF_GetString(e),-1),this.OpenAction.Bottom=PDF_StrToFloatDef(PDF_GetString(e),-1),this.OpenAction.Right=PDF_StrToFloatDef(PDF_GetString(e),-1),this.OpenAction.Top=PDF_StrToFloatDef(PDF_GetString(e),-1)):"/FitB"==t?this.OpenAction.SubType=TPDFOpenActionType.oaFitB:"/FitBH"==t?(this.OpenAction.SubType=TPDFOpenActionType.oaFitBH,this.OpenAction.Top=PDF_StrToFloatDef(PDF_GetString(e),-1)):"/FitBV"==t?(this.OpenAction.SubType=TPDFOpenActionType.oaFitBV,this.OpenAction.Left=PDF_StrToFloatDef(PDF_GetString(e),-1)):"/XYZ"==t?(this.OpenAction.SubType=TPDFOpenActionType.oaXYZ,this.OpenAction.Left=PDF_StrToFloatDef(PDF_GetString(e),-1),this.OpenAction.Top=PDF_StrToFloatDef(PDF_GetString(e),-1),this.OpenAction.Zoom=PDF_StrToFloatDef(PDF_GetString(e),-1)):this.OpenAction.SubType=TPDFOpenActionType.oaDefault)},GetDeirect_OpenAction_Dictionary:function(e){for(var t;;)if("/D"==(t=PDF_GetString(e)))"["==(t=PDF_GetString(e))&&this.GetDeirect_OpenAction_Array(e);else if("("==t)PDF_TextSkip(e);else if("%"==t)PDF_CommnetSkip(e);else if(">"==t)break},GetInDeirect_OpenAction:function(e,t){var r,i;i=e.Stream.Pos,e.Stream.Pos=parseInt(e.ObjectPosArray[t],10);try{for(PDF_TopLineSkip(e.Stream);;)if("%"==(r=PDF_GetString(e.Stream)))PDF_CommnetSkip(e.Stream);else{if("<"==r){e.Stream.Pos=e.Stream.Pos+1,this.GetDeirect_OpenAction_Dictionary(e.Stream);break}if("["==r){this.GetDeirect_OpenAction_Array(e.Stream);break}if("endobj"==r)break}}finally{e.Stream.Pos=i}},GetPDFDocView:function(e){var t,r;if(e.IsObjectID(e.RootID)&&!e.Encrypt){r=e.Stream.Pos,e.Stream.Pos=parseInt(e.ObjectPosArray[e.RootID],10);try{for(PDF_TopLineSkip(e.Stream);;)if("/PageLayout"==(t=PDF_GetString(e.Stream)))t=PDF_GetString(e.Stream),this.PageLayout="/SinglePage"==t?TPDFPageLayout.plSinglePage:"/OneColumn"==t?TPDFPageLayout.plOneColumn:"/TwoColumnLeft"==t?TPDFPageLayout.plTwoColumnLeft:"/TwoColumnRight"==t?TPDFPageLayout.plTwoColumnRight:TPDFPageLayout.plDefault;else if("/PageMode"==t)t=PDF_GetString(e.Stream),this.PageMode="/UseNone"==t?TPDFPageMode.pmUseNone:"/UseOutlines"==t?TPDFPageMode.pmUseOutlines:"/UseThumbs"==t?TPDFPageMode.pmUseThumbs:"/FullScreen"==t?TPDFPageMode.pmFullScreen:TPDFPageMode.pmDefault;else if("/ViewerPreferences"==t)"<"==(t=PDF_GetString(e.Stream))?(e.Stream.Pos=e.Stream.Pos+1,this.GetDeirect_ViewerPreferences(e.Stream)):t[0].match(/[1-9]+/)&&e.IsObjectID(t)&&this.GetInDeirect_ViewerPreferences(e,parseInt(t,10));else if("/OpenAction"==t)"["==(t=PDF_GetString(e.Stream))?this.GetDeirect_OpenAction_Array(e.Stream):"<"==t?this.GetDeirect_OpenAction_Dictionary(e.Stream):t[0].match(/[1-9]+/)&&e.IsObjectID(t)&&this.GetInDeirect_OpenAction(e,parseInt(t,10));else if("("==t)PDF_TextSkip(e.Stream);else if("%"==t)PDF_CommnetSkip(e.Stream);else if("endobj"==t)break}finally{e.Stream.Pos=r}}}},TPDFCombine.prototype={init:function(e,t){var r=new TFileStream;this._BassID=3,this._PageList=new Array;for(var i=new TPDFParser(this._ObjectMem,this._PageList),n=0;n<e.length;n++)e[n].Encrypt&&e[n].LoadError(PDFDESIGNER_ERROR_025),e[n].PageCount;r.WriteString("1.4\n"),this._ObjectMem.ObjectIndex=this._ObjectMem.ObjectIndex+2;for(n=0;n<e.length;n++){null!=t&&setTimeout(t,500,Math.floor(n/e.length*100),n+1,e.length),0!=n&&(this._BassID=this._ObjectMem.ObjectIndex+1);var o=new Array;e[n].GetPageInfo(o);for(var a=0;a<e[n].PageCount;a++)i.GetPageInObjectList(e[n],o[a],o);var s=PDF_OverlappingCut(o);for(a=0;a<e[n].PageCount;a++)i.WritePDFPage(e[n],o[a],r,s,this._BassID);var S=s.length;for(a=e[n].PageCount;a<S;a++)i.WritePDFObject(e[n],s[a],r,s,this._BassID)}return i.WritePDFHedaer(r,this._ObjectMem,this.View,this._PageList[0]),i.WritePDFFooter(r,this.Info),null!=t&&setTimeout(t,500,100,e.length,e.length),r},SaveToFile:function(e,...t){return AStream=this.init.apply(this,t),AStream.SaveToFile(e)},SaveToBlob:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlob()},SaveToBlobUrl:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlobUrl()}},TPDFKnife.prototype={init:function(e,t,r){var i=new TFileStream,n=new Array;this._BassID=3,this._PageList=new Array;var o=new TPDFParser(this._ObjectMem,this._PageList);e.Encrypt&&e.LoadError(PDFDESIGNER_ERROR_025),(t<1||r>e.PageCount||t>r)&&e.LoadError(PDFDESIGNER_ERROR_030),i.WriteString("1.4\n"),this._ObjectMem.ObjectIndex=this._ObjectMem.ObjectIndex+2;var a=new Array;e.GetPageInfo(a);for(var s=t-1;s<r;s++)s>=0&&s<=a.length-1&&(n[n.length]=a[s]);a=new Array;for(s=0;s<n.length;s++)a[a.length]=parseInt(n[s],10);for(s=0;s<a.length;s++)o.GetPageInObjectList(e,a[s],n);var S=PDF_OverlappingCut(n);for(s=0;s<a.length;s++)o.WritePDFPage(e,a[s],i,S,this._BassID);var P=S.length;for(s=a.length;s<P;s++)o.WritePDFObject(e,S[s],i,S,this._BassID);return o.WritePDFHedaer(i,this._ObjectMem,this.View,this._PageList[0]),o.WritePDFFooter(i,this.Info),i},SaveToFile:function(e,...t){return AStream=this.init.apply(this,t),AStream.SaveToFile(e)},SaveToBlob:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlob()},SaveToBlobUrl:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlobUrl()}},TPDFDeletePage.prototype={init:function(e,t,r){var i=new TFileStream,n=new Array;this._BassID=3,this._PageList=new Array;var o=new TPDFParser(this._ObjectMem,this._PageList);e.Encrypt&&e.LoadError(PDFDESIGNER_ERROR_025),(t<1||r>e.PageCount||t>r)&&e.LoadError(PDFDESIGNER_ERROR_030),1==t&&e.PageCount==r&&e.LoadError(PDFDESIGNER_ERROR_035),i.WriteString("1.4\n"),this._ObjectMem.ObjectIndex=this._ObjectMem.ObjectIndex+2;var a=new Array;e.GetPageInfo(a);for(var s=0;s<e.PageCount;s++)s+1>=t&&s+1<=r||(n[n.length]=a[s]);a=new Array;for(s=0;s<n.length;s++)a[a.length]=parseInt(n[s],10);for(s=0;s<a.length;s++)o.GetPageInObjectList(e,a[s],n);var S=PDF_OverlappingCut(n);for(s=0;s<a.length;s++)o.WritePDFPage(e,a[s],i,S,this._BassID);var P=S.length;for(s=a.length;s<P;s++)o.WritePDFObject(e,S[s],i,S,this._BassID);return o.WritePDFHedaer(i,this._ObjectMem,this.View,this._PageList[0]),o.WritePDFFooter(i,this.Info),i},SaveToFile:function(e,...t){return AStream=this.init.apply(this,t),AStream.SaveToFile(e)},SaveToBlob:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlob()},SaveToBlobUrl:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlobUrl()}},TPDFRotatePage.prototype={init:function(e,t,r,i){var n=new Array,o=new Array,a=new TFileStream;function s(e){for(var t=0;t<o.length;t++)if(o[t]==e)return!0;return!1}function S(t,r,i,n,o,a){var s,S,P;function h(){var r;(r=e.Stream.Pos)!=s&&(e.Stream.Pos=s,t.WriteStream(e.Stream,s,r),e.Stream.Pos=r)}var c=!1,g=e.Stream.Pos;for(e.Stream.Pos=parseInt(e.ObjectPosArray[r],10),PDF_TopLineSkip(e.Stream),t.WriteString(a.ObjectIndex+1+" "+n+" obj\n");;)if(s=e.Stream.Pos,""!=(S=PDF_GetString(e.Stream)))if("%"!=S){if("("==S)PDF_TextSkip(e.Stream);else{if("/Rotate"==S){c=!0,P=PDF_StrToIntDef(S=PDF_GetString(e.Stream),0),e.Stream.Pos=e.Stream.Pos-S.length,h(),o=1==o?P+90>=360?P+90-360:P+90:2==o?P-90<0?270:P-90:3==o?P+180>=360?P+180-360:P+180:0,t.WriteString(o+"\n"),e.Stream.Pos=e.Stream.Pos+S.length;continue}if("/Length"==S)e.GetObjectType_Integer(e.Stream);else if("stream"==S);else if("endobj"==S){if(h(),!c){var l=new TMemoryStream(t,0,t.getFileSize());for(l.Pos=l.getFileSize(),l.Pos=l.Pos-"endobj".length;;){if(">"==(P=l.ReadString(1))){l.Pos=l.Pos-2,l.Stream=l.Stream.subarray(0,l.Pos);break}l.Pos=l.Pos-2}t.Rewrite(l),o=1==o?90:2==o?270:3==o?180:0,t.WriteString("\n"),t.WriteString("/Rotate "+o+"\n"),t.WriteString(">>\n"),t.WriteString("endobj")}break}}h()}else PDF_CommnetSkip(e.Stream);e.Stream.Pos=g}var P,h=new Array;e.Encrypt&&e.LoadError(PDFDESIGNER_ERROR_025),(r<1||i>e.PageCount||r>i)&&e.LoadError(PDFDESIGNER_ERROR_030),t>=1&&t<=3||e.LoadError(PDFDESIGNER_ERROR_040),a.WriteString(e.Version+"\n"),e.GetPageInfo(h);for(var c=r-1;c<i;c++)o[o.length]=parseInt(h[c],10);for(c=1;c<e.ObjectPosArray.length;c++)e.DeleteObject[c]?(this._ObjectMem.ObjectPosArray[this._ObjectMem.ObjectIndex]=a.Pos,a.WriteString(this._ObjectMem.ObjectIndex+1+" 0 obj\n"),a.WriteString("<<\n"),a.WriteString(">>\n"),a.WriteString("endobj\n"),n[this._ObjectMem.ObjectIndex]=0):(e.Stream.Pos=parseInt(e.ObjectPosArray[this._ObjectMem.ObjectIndex+1],10),PDF_GetString(e.Stream),n[this._ObjectMem.ObjectIndex]=parseInt(PDF_GetString(e.Stream),10),this._ObjectMem.ObjectPosArray[this._ObjectMem.ObjectIndex]=a.getFileSize(),P=e.GetObjectSize(c),s(c)?S(a,c,0,n[this._ObjectMem.ObjectIndex],t,this._ObjectMem):(e.Stream.Pos=parseInt(e.ObjectPosArray[c],10),a.WriteStream(e.Stream,e.Stream.Pos,e.Stream.Pos+P)),a.WriteString("\n")),this._ObjectMem.ObjectIndex++;return function(e){e.ObjectPosArray[e.ObjectIndex]=a.getFileSize(),a.WriteString("xref\n"),a.WriteString("0 "+(e.ObjectIndex+1)+"\n"),a.WriteString("0000000000 65535 f \n");for(var t=0;t<e.ObjectPosArray.length-1;t++)a.WriteString(PDF_ConvertObjectPos([e.ObjectPosArray[t]],10)+" "+PDF_ConvertObjectPos([n[t]],5)+" n \n")}(this._ObjectMem),a.WriteString("trailer\n"),a.WriteString("<<\n"),a.WriteString("/Size "+(this._ObjectMem.ObjectIndex+1)+"\n"),-1!=e.InfoID&&a.WriteString("/Info "+e.InfoID+" 0 R\n"),a.WriteString("/Root "+e.RootID+" 0 R\n"),a.WriteString(">>\n"),a.WriteString("startxref\n"),a.WriteString(this._ObjectMem.ObjectPosArray[this._ObjectMem.ObjectIndex]+"\n"),a.WriteString("%%EOF\n"),a},SaveToFile:function(e,...t){return AStream=this.init.apply(this,t),AStream.SaveToFile(e)},SaveToBlob:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlob()},SaveToBlobUrl:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlobUrl()}},TPDFInfoMaker.prototype={PageIDtoPageNumber:function(e,t){for(var r=parseInt(e,10),i=0;i<t.length;i++)if(r==parseInt(t[i],10))return i+1;return-1},PageNumbertoPageID:function(e,t){var r=e-1;return r>=0&&r<t.length?parseInt(t[r],10):-1},init:function(e){var t=new TFileStream;e.Encrypt&&e.LoadError(PDFDESIGNER_ERROR_025),this._ObjectMem.ObjectIndex=e.ObjectPosArray.length-1;var r=new TPDFParser(this._ObjectMem,null);return e.Stream.Pos=0,t.WriteStream(e.Stream,"%PDF-".length,e.Stream.FileSize),t.Pos=t.getFileSize(),r.WritePDFHedaer_Maker(e,t,this._ObjectMem,this.View,!1),r.WritePDFFooter_Maker(e,t,this._ObjectMem,this.Info),-1!=e.InfoID&&r.WriteDummyInfo(e,t),t},SaveToFile:function(e,...t){return AStream=this.init.apply(this,t),AStream.SaveToFile(e)},SaveToBlob:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlob()},SaveToBlobUrl:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlobUrl()}},TPDFNode.prototype={Get:function(e){if(0==this.ChildNodes.GetCount())throw PDFDESIGNER_ERROR_050;if(e<0||e>this.ChildNodes.GetCount()-1)throw PDFDESIGNER_ERROR_051;return this.ChildNodes[e]},AddChild:function(e,t,r,i,n,o,a){if(this.Level>=4)throw PDFDESIGNER_ERROR_052;return this.ChildNodes.Add(this,this.Level+1,e,t,r,i,n,o,a)},GetCount:function(){return this.ChildNodes.GetCount()},GetChildCount:function(){var e=0;if(0==this.ChildNodes.GetCount())return e;e=this.ChildNodes.GetCount();for(var t=0;t<this.ChildNodes.GetCount();t++){e+=this.ChildNodes.Get(t).GetChildCount()}return e}},TPDFNodeList.prototype={GetCount:function(){return this._list.length},Add:function(e,t,r,i,n,o,a,s,S){var P=new TPDFNode(e,t,r,i,n,o,a,s,S);return this._list[this._list.length]=P,P},Get:function(e){if(0==this._list.length)throw PDFDESIGNER_ERROR_053;if(e<0||e>this._list.length-1)throw PDFDESIGNER_ERROR_051;return this._list[e]}},TPDFOutLineManager.prototype={Get:function(e){if(0==this.Node.GetCount())throw PDFDESIGNER_ERROR_053;if(e<0||e>this.Node.GetCount()-1)throw PDFDESIGNER_ERROR_051;return this.Node.Get(e)},AddRoot:function(e,t,r,i,n,o,a){return this.Node.Add(null,0,e,t,r,i,n,o,a)},GetCount:function(){return this.Node.GetCount()},GetNodeCount:function(){for(var e=this.Node.GetCount(),t=0;t<this.Node.GetCount();t++){e+=this.Node.Get(t).GetChildCount()}return e},GetFirstNode:function(){return 0==this.Node.GetCount()?null:this.Node.Get(0)},GetLastNode:function(){var e;if(0==this.Node.GetCount())return null;for(e=this.Node.Get(this.Node.GetCount()-1);0!=e.GetCount();)e=e.Get(e.GetCount()-1);return e},SaveToStream:function(e,t,r){var i,n,o,a,s,S=new TPDFCode;function P(e,t,r,i){return""==i?e/255+" "+t/255+" "+r/255:e/255+" "+t/255+" "+r/255+" "+i}function h(n,o){var a,s;s=-1;for(var c=0;c<n.GetCount();c++){if((a=n.ChildNodes.Get(c))._ID=r.ObjectIndex+1,r.ObjectPosArray[r.ObjectIndex]=t.getFileSize(),t.WriteString(r.ObjectIndex+1+" 0 obj\n",[r.ObjectIndex+1]),t.WriteString("<<\n"),t.WriteString("/Parent "+a.Parent._ID+" 0 R\n"),-1!=a.Page){if(a.Page>o.length)throw PDFDESIGNER_ERROR_030;if(a.ShowPos<0)t.WriteString("/Dest [ "+o[a.Page-1]+" 0 R /XYZ null null null ]\n");else{var g=e.GetMediaBox(o[a.Page-1]);-1!=(i=PDF_GetMediaBoxRect(g).Bottom)?t.WriteString("/Dest [ "+o[a.Page-1]+" 0 R /XYZ null "+(i-a.ShowPos)+" null ]\n"):t.WriteString("/Dest [ "+o[a.Page-1]+" 0 R /XYZ null null null ]\n")}}else t.WriteString("/A << /S /URI /URI ("+a.URL+") >>\n");t.WriteString("/Title ("+S.PDFDocEncoding(a.Caption)+")\n"),0!=a.GetCount()&&(t.WriteString("/First "+(r.ObjectIndex+2)+" 0 R\n"),t.WriteString("/Last "+(r.ObjectIndex+1+a.GetChildCount())+" 0 R\n")),c!=n.GetCount()-1&&t.WriteString("/Next "+(r.ObjectIndex+2+a.GetChildCount())+" 0 R\n"),0!=c&&t.WriteString("/Prev "+s+" 0 R\n"),t.WriteString("/Count "+a.GetChildCount()+"\n"),null!=a.Color&&t.WriteString("/C ["+P(a.Color.Red,a.Color.Green,a.Color.Blue,"")+"]\n"),a.Bold&&a.Italic?t.WriteString("/F 3\n"):a.Bold&&!a.Italic?t.WriteString("/F 2\n"):!a.Bold&&a.Italic&&t.WriteString("/F 1\n"),t.WriteString(">>\n"),t.WriteString("endobj\n"),r.ObjectIndex++,s=r.ObjectIndex,0!==a.Count&&h(a,o)}}var c=-1;if(e.GetPageInfo(this._PageList),0==this.GetCount())return c;c=r.ObjectIndex+1,a=-1,NodeCnt=this.GetNodeCount(),n=this.GetCount(),r.ObjectPosArray[r.ObjectIndex]=t.getFileSize(),t.WriteString(r.ObjectIndex+1+" 0 obj\n"),t.WriteString("<<\n"),t.WriteString("/Type /Outlines\n"),0!=NodeCnt&&(t.WriteString("/First "+(r.ObjectIndex+2)+" 0 R\n"),t.WriteString("/Last "+(r.ObjectIndex+1+NodeCnt)+" 0 R\n")),t.WriteString("/Count "+NodeCnt+"\n"),t.WriteString(">>\n"),t.WriteString("endobj\n"),r.ObjectIndex++,o=r.ObjectIndex;for(var g=0;g<n;g++){if((s=this.Node.Get(g))._ID=r.ObjectIndex+1,r.ObjectPosArray[r.ObjectIndex]=t.getFileSize(),t.WriteString(r.ObjectIndex+1+" 0 obj\n"),t.WriteString("<<\n"),t.WriteString("/Parent "+o+" 0 R\n"),-1!=s.Page){if(s.Page>this._PageList.length)throw PDFDESIGNER_ERROR_030;if(s.ShowPos<0)t.WriteString("/Dest [ "+this._PageList[s.Page-1]+" 0 R /XYZ null null null ]\n");else{var l=e.GetMediaBox(this._PageList[s.Page-1]);-1!=(i=PDF_GetMediaBoxRect(l).Bottom)?t.WriteString("/Dest [ "+this._PageList[s.Page-1]+" 0 R /XYZ null "+(i-s.ShowPos)+" null ]\n"):t.WriteString("/Dest [ "+this._PageList[s.Page-1]+" 0 R /XYZ null null null ]\n")}}else t.WriteString("/A << /S /URI /URI ("+s.URL+") >>\n");t.WriteString("/Title ("+S.PDFDocEncoding(s.Caption)+")\n"),0!=s.GetCount()&&(t.WriteString("/First "+(r.ObjectIndex+2)+" 0 R\n"),t.WriteString("/Last "+(r.ObjectIndex+1+s.GetChildCount())+" 0 R\n")),g!=n-1&&t.WriteString("/Next "+(r.ObjectIndex+2+s.GetChildCount())+" 0 R\n"),0!=g&&t.WriteString("/Prev "+a+" 0 R\n"),t.WriteString("/Count "+s.GetChildCount()+"\n"),null!=s.Color&&t.WriteString("/C ["+P(s.Color.Red,s.Color.Green,s.Color.Blue,"")+"]\n"),s.Bold&&s.Italic?t.WriteString("/F 3\n"):s.Bold&&!s.Italic?t.WriteString("/F 2\n"):!s.Bold&&s.Italic&&t.WriteString("/F 1\n"),t.WriteString(">>\n"),t.WriteString("endobj\n"),r.ObjectIndex++,a=r.ObjectIndex,0!=s.GetCount()&&h(s,this._PageList)}}},TPDFOutLineMaker.prototype={GetOutLineList:function(e){var t=new Array,r=new TPDFCode;return e.Encrypt&&e.LoadError(PDFDESIGNER_ERROR_025),-1!=e.OutlinesID&&function i(n,o){var a,s,S=new Array,P=new Array;for(e.Stream.Pos,e.Stream.Pos=parseInt(e.ObjectPosArray[n],10);;)if(""!=(a=PDF_GetString(e.Stream)))if("/First"==a)a=PDF_GetString(e.Stream),e.IsObjectID(a)&&(S[S.length]=parseInt(a,10));else if("/Next"==a)a=PDF_GetString(e.Stream),e.IsObjectID(a)&&(P[P.length]=parseInt(a,10));else if("/Title"==a){if(null==(s=r.GetPDFTextStream(e.Stream)))break;a="";for(var h=0;h<o;h++)a+="    ";t[t.length]=a+s}else if("("==a)PDF_TextSkip(e.Stream);else if("endobj"==a)break;if(0!=S.length)for(h=0;h<S.length;h++)i(S[h],o+1);if(0!=P.length)for(h=0;h<P.length;h++)i(P[h],o)}(e.OutlinesID,-1),t},init:function(e){var t=new TFileStream;e.Encrypt&&e.LoadError(PDFDESIGNER_ERROR_025),this._ObjectMem.ObjectIndex=e.ObjectPosArray.length-1;var r=new TPDFParser(this._ObjectMem,null);return e.Stream.Pos=0,t.WriteStream(e.Stream,"%PDF-".length,e.Stream.FileSize),t.Pos=t.getFileSize(),r.WritePDFHedaer_Maker(e,t,this._ObjectMem,this.View,!0),this.OutLine.SaveToStream(e,t,this._ObjectMem),r.WritePDFFooter_Maker(e,t,this._ObjectMem,this.Info),-1!=e.InfoID&&r.WriteDummyInfo(e,t),t},SaveToFile:function(e,...t){return AStream=this.init.apply(this,t),AStream.SaveToFile(e)},SaveToBlob:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlob()},SaveToBlobUrl:function(){return AStream=this.init.apply(this,arguments),AStream.SaveToBlobUrl()}};